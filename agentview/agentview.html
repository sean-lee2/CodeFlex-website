<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta charset="utf-8"/>

        <title>Agent View - URDF Robot Viewer</title>

        <!-- Import Map for Three.js and Physics -->
        <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/examples/jsm/": "https://unpkg.com/three@0.164.1/examples/jsm/",
                "cannon-es": "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"
            }
        }
        </script>

        <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.4.3/webcomponents-bundle.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet"/>
        
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Roboto', sans-serif;
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                color: #ffffff;
                overflow: hidden;
                height: 100vh;
            }

            .main-container {
                display: flex;
                height: 100vh;
                width: 100vw;
            }

            .left-panel {
                flex: 1;
                display: flex;
                flex-direction: column;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border-right: 2px solid #0f3460;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            }

            .panel-header {
                background: linear-gradient(90deg, #0f3460 0%, #16537e 100%);
                color: #ffffff;
                padding: 15px 20px;
                font-size: 18px;
                font-weight: 300;
                text-align: center;
                border-bottom: 2px solid #0a2a4a;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            }

            .viewer-container {
                flex: 1;
                position: relative;
                background: #0a0a0a;
                overflow: hidden;
            }

            urdf-viewer {
                width: 100%;
                height: 100%;
                display: block;
                background: radial-gradient(circle at center, #1a1a2e 0%, #0a0a0a 100%);
            }

            /* ğŸ­ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ - ê³µì¥ í…Œë§ˆ (ì›ë³¸ê³¼ ë™ì¼) */
            .factory-loading {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                opacity: 1;
                transition: opacity 0.5s ease-out;
            }

            .factory-loading.hidden {
                opacity: 0;
                pointer-events: none;
            }

            .company-logo {
                font-size: 72px;
                font-weight: 400;
                font-family: 'Times New Roman', serif;
                margin-bottom: 60px;
                text-align: center;
                letter-spacing: -2px;
                text-transform: none;
                position: relative;
                animation: logoGlow 2s ease-in-out infinite alternate;
                height: 90px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .company-logo::before {
                content: 'Code';
                color: #000000;
                font-weight: 400;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .company-logo::after {
                content: 'Flex';
                color: #5B9BD5;
                font-weight: 400;
                text-shadow: 0 2px 4px rgba(91, 155, 213, 0.2);
            }

            @keyframes logoGlow {
                0% { 
                    filter: brightness(1);
                    transform: scale(1);
                }
                100% { 
                    filter: brightness(1.2);
                    transform: scale(1.02);
                }
            }

            .company-tagline {
                font-size: 16px;
                font-weight: 300;
                font-family: 'Segoe UI', 'Arial', sans-serif;
                color: rgba(255, 255, 255, 0.9);
                text-align: center;
                letter-spacing: 2px;
                text-transform: uppercase;
                margin-bottom: 15px;
                opacity: 0.9;
                animation: logoGlow 2s ease-in-out infinite alternate;
            }

            .loading-progress {
                width: 300px;
                height: 4px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 2px;
                overflow: hidden;
                position: relative;
                opacity: 0.9;
                animation: logoGlow 2s ease-in-out infinite alternate;
            }

            .loading-progress::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, #5B9BD5, transparent);
                animation: loading-sweep 2s ease-in-out infinite;
            }

            @keyframes loading-sweep {
                0% { left: -100%; }
                100% { left: 100%; }
            }

            /* ë°˜ì‘í˜• ë””ìì¸ */
            @media (max-width: 768px) {
                .panel-header {
                    font-size: 16px;
                    padding: 12px 15px;
                }
                
                .company-logo {
                    width: 80px;
                    height: 80px;
                }
                
                .company-tagline {
                    font-size: 18px;
                }
                
                .loading-progress {
                    width: 250px;
                }
            }
        </style>
    </head>
    <body tabindex="0">
        <!-- ğŸ­ ê³µì¥ í…Œë§ˆ ë¡œë”© í™”ë©´ -->
        <div id="factory-loading" class="factory-loading">
            <div class="company-logo"></div>
            <div class="company-tagline">Digital Twin Solutions</div>
            <div class="loading-progress"></div>
        </div>
        
        <div class="main-container">
            <!-- Agent View -->
            <div class="left-panel">
                <div class="viewer-container">
                    <urdf-viewer up="+Z" display-shadow tabindex="0" urdf="urdf-loaders-master/urdf/INP3/INP3/INP3.urdf" autocenter></urdf-viewer>
                </div>
            </div>
        </div>

        <script type="module">
            // URDF ë·°ì–´ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
            import * as THREE from 'three';
            import { STLLoader } from 'three/examples/jsm/loaders/STLLoader.js';
            import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
            import { ColladaLoader } from 'three/examples/jsm/loaders/ColladaLoader.js';
            import { OBJLoader } from 'three/examples/jsm/loaders/OBJLoader.js';
            import URDFManipulator from './urdf-loaders-master/javascript/src/urdf-manipulator-element.js';
            
            // URDF ë·°ì–´ ì»´í¬ë„ŒíŠ¸ ë“±ë¡
            customElements.define('urdf-viewer', URDFManipulator);
            
            // ë¡œë”© í™”ë©´ ì œì–´ í•¨ìˆ˜ë“¤ (ì›ë³¸ê³¼ ë™ì¼)
            function showFactoryLoading() {
                const loadingScreen = document.getElementById('factory-loading');
                if (loadingScreen) {
                    loadingScreen.classList.remove('hidden');
                    console.log('ğŸ­ Factory loading screen shown');
                }
            }

            function hideFactoryLoading() {
                const loadingScreen = document.getElementById('factory-loading');
                if (loadingScreen) {
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        console.log('ğŸ­ Factory loading screen hidden');
                    }, 200); // 0.2ì´ˆ í›„ ë¹ ë¥´ê²Œ ìˆ¨ê¹€
                }
            }


            // ë¡œë”© í™”ë©´ í‘œì‹œ ë° ìµœì†Œ ì‹œê°„ ì¶”ì  (ì›ë³¸ê³¼ ë™ì¼)
            const loadingStartTime = Date.now();
            showFactoryLoading();
            
            // URDF ë·°ì–´ ì´ˆê¸°í™” ëŒ€ê¸° (ë¹ ë¥¸ ì´ˆê¸°í™”) - ì›ë³¸ê³¼ ë™ì¼
            setTimeout(() => {
                const viewer = document.querySelector('urdf-viewer');
                if (viewer) {
                    console.log('URDF Viewer found and initialized');
                    
                    // ë·°ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • - ì‹¤ì œ ëª¨ë¸ ë¡œë”© ì™„ë£Œ ê°ì§€
                    let urdfProcessed = false;
                    let geometryLoaded = false;
                    
                    viewer.addEventListener('urdf-processed', () => {
                        console.log('ğŸ“‹ URDF file processed');
                        urdfProcessed = true;
                        checkLoadingComplete();
                    });
                    
                    viewer.addEventListener('geometry-loaded', () => {
                        console.log('ğŸ¯ 3D Geometry loaded successfully');
                        geometryLoaded = true;
                        checkLoadingComplete();
                    });
                    
                    function checkLoadingComplete() {
                        if (urdfProcessed && geometryLoaded) {
                            console.log('âœ… All systems ready - checking minimum loading time');
                            
                            // ìµœì†Œ 1.5ì´ˆ ë¡œë”© ì‹œê°„ ë³´ì¥
                            const elapsedTime = Date.now() - loadingStartTime;
                            const remainingTime = Math.max(0, 1500 - elapsedTime);
                            
                            console.log(`â±ï¸ Elapsed: ${elapsedTime}ms, Remaining: ${remainingTime}ms`);
                            
                            setTimeout(() => {
                                hideFactoryLoading();
                            }, remainingTime);
                        }
                    }
                } else {
                    console.warn('URDF Viewer not found');
                    // ì—ëŸ¬ ì‹œì—ë„ ìµœì†Œ 1.5ì´ˆ ë³´ì¥
                    const elapsedTime = Date.now() - loadingStartTime;
                    const remainingTime = Math.max(0, 1500 - elapsedTime);
                    
                    setTimeout(() => {
                        hideFactoryLoading();
                    }, remainingTime);
                }
            }, 100);
            
            // íƒ€ì„ì•„ì›ƒ ë³´í˜¸ (ì›ë³¸ê³¼ ë™ì¼)
            setTimeout(() => {
                const loadingScreen = document.getElementById('factory-loading');
                if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
                    console.log('âš ï¸ Loading timeout - forcing hide');
                    
                    // íƒ€ì„ì•„ì›ƒ ì‹œì—ë„ ìµœì†Œ 1.5ì´ˆ ë³´ì¥
                    const elapsedTime = Date.now() - loadingStartTime;
                    const remainingTime = Math.max(0, 1500 - elapsedTime);
                    
                    setTimeout(() => {
                        hideFactoryLoading();
                    }, remainingTime);
                }
            }, 5000);
            
            // ğŸ­ WADF Full Assembly Sequence ë°ì´í„° (websocket_server.pyì—ì„œ ì¶”ì¶œ)
            const WADF_ASSEMBLY_SEQUENCE = {
                1: [ // GRIPPER_TEST2_01: í”½ì—… í¬ì§€ì…˜ìœ¼ë¡œ ì´ë™
                    {joint: 'Rotation_31', value: -0.389, delay: 500}, // -22.3ë„
                    {joint: 'Rotation_36', value: 0.024, delay: 500},   // 1.4ë„
                    {joint: 'Rotation_151', value: 1.209, delay: 500}, // 69.3ë„
                    {joint: 'Slider_44', value: 0.0, delay: 500}
                ],
                2: [ // GRIPPER_TEST2_02: Zì¶• í•˜ê°• (ë¶€í’ˆìœ¼ë¡œ)
                    {joint: 'Slider_44', value: -0.045, delay: 1000}
                ],
                3: [ // GRIPPER_TEST2_03: ê·¸ë¦¬í¼ ë‹«ê¸°
                    {joint: 'Slider_41', value: 0.0135, delay: 500},
                    {joint: 'Slider_42', value: 0.0135, delay: 500}
                ],
                7: [ // GRIPPER_TEST2_07: Zì¶• ìƒìŠ¹ (ë¶€í’ˆ ë“¤ì–´ì˜¬ë¦¬ê¸°)
                    {joint: 'Slider_44', value: 0.0, delay: 1000}
                ],
                8: [ // GRIPPER_TEST2_08: ì¡°ë¦½ í¬ì§€ì…˜ìœ¼ë¡œ ì´ë™
                    {joint: 'Rotation_31', value: 1.484, delay: 1000}, // 85ë„
                    {joint: 'Rotation_36', value: -1.134, delay: 1000},  // -65ë„
                    {joint: 'Rotation_151', value: 3.491, delay: 1000}  // 200ë„
                ],
                9: [ // GRIPPER_TEST2_09: ì¡°ë¦½ì„ ìœ„í•œ Zì¶• í•˜ê°•
                    {joint: 'Slider_44', value: -0.02, delay: 800}
                ],
                10: [ // GRIPPER_TEST2_10: ì •ë°€ í¬ì§€ì…”ë‹ (ë” í•˜ê°•)
                    {joint: 'Slider_44', value: -0.04, delay: 1000}
                ],
                16: [ // GRIPPER_TEST2_16: ê·¸ë¦¬í¼ ì—´ê¸° (ë¶€í’ˆ í•´ì œ)
                    {joint: 'Slider_41', value: 0.0, delay: 500},
                    {joint: 'Slider_42', value: 0.0, delay: 500}
                ],
                20: [ // GRIPPER_TEST2_20: Zì¶• ìƒìŠ¹ (ì² ìˆ˜)
                    {joint: 'Slider_44', value: 0.0, delay: 1000}
                ],
                21: [ // GRIPPER_TEST2_21: í™ˆ í¬ì§€ì…˜ìœ¼ë¡œ ë³µê·€
                    {joint: 'Rotation_31', value: 0.0, delay: 1000},
                    {joint: 'Rotation_36', value: 0.0, delay: 1000},
                    {joint: 'Rotation_151', value: 1.571, delay: 1000}, // 90ë„
                    {joint: 'Slider_44', value: 0.0, delay: 1000}
                ]
            };

            // ğŸ­ Full Assembly Sequence ì‹¤í–‰ ìˆœì„œ (websocket_server.pyì—ì„œ ì¶”ì¶œ)
            const FULL_ASSEMBLY_STEPS = [
                {step: 1, description: 'Check pallet arrival', delay: 100},
                {step: 2, gripper_test: 1, description: 'Move to pickup position', delay: 100},
                {step: 3, gripper_test: 2, description: 'Lower to part', delay: 100},
                {step: 4, gripper_test: 3, description: 'Close gripper', delay: 100},
                {step: 5, description: 'Activate assembly block', delay: 100},
                {step: 6, gripper_test: 7, description: 'Lift part', delay: 100},
                {step: 7, gripper_test: 8, description: 'Move to assembly position', delay: 100},
                {step: 8, gripper_test: 9, description: 'Lower to assembly', delay: 100},
                {step: 9, gripper_test: 10, description: 'Precise positioning', delay: 100},
                {step: 10, description: 'Activate engraving', delay: 100},
                {step: 11, description: 'Engraving process', delay: 100},
                {step: 12, gripper_test: 16, description: 'Open gripper', delay: 100},
                {step: 13, gripper_test: 20, description: 'Retract Z-axis', delay: 100},
                {step: 14, description: 'Push completed part', delay: 100},
                {step: 15, gripper_test: 21, description: 'Return home', delay: 100},
                {step: 16, description: 'Confirm part output', delay: 100},
                {step: 17, description: 'Move conveyor for next cycle', delay: 100}
            ];

            // ğŸ­ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë³´ê°„ í•¨ìˆ˜ë“¤
            function lerp(start, end, factor) {
                return start + (end - start) * factor;
            }

            // ğŸ­ Easing í•¨ìˆ˜ë“¤ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´)
            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            function easeOutQuart(t) {
                return 1 - Math.pow(1 - t, 4);
            }

            function easeInOutSine(t) {
                return -(Math.cos(Math.PI * t) - 1) / 2;
            }

            // ğŸ­ ë¶€ë“œëŸ¬ìš´ ì¡°ì¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ (Easing ì ìš©)
            async function animateJointSmoothly(viewer, jointName, targetValue, duration = 1000, steps = 60) {
                if (!viewer) return;
                
                try {
                    // í˜„ì¬ ì¡°ì¸íŠ¸ ê°’ ê°€ì ¸ì˜¤ê¸°
                    let currentValue = 0;
                    if (viewer.robot && viewer.robot.joints[jointName]) {
                        currentValue = viewer.robot.joints[jointName].angle || 0;
                    }
                    
                    const startValue = currentValue;
                    const stepDuration = duration / steps;
                    
                    // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ (Easing ì ìš©)
                    for (let i = 0; i <= steps; i++) {
                        if (!animationRunning) break;
                        
                        const linearFactor = i / steps;
                        // ì¡°ì¸íŠ¸ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ easing ì ìš©
                        let easedFactor;
                        if (jointName.includes('Rotation')) {
                            // íšŒì „ ì¡°ì¸íŠ¸: ë¶€ë“œëŸ¬ìš´ ì‹œì‘ê³¼ ë
                            easedFactor = easeInOutSine(linearFactor);
                        } else if (jointName.includes('Slider')) {
                            // ìŠ¬ë¼ì´ë” ì¡°ì¸íŠ¸: ìì—°ìŠ¤ëŸ¬ìš´ ê°ì†
                            easedFactor = easeOutQuart(linearFactor);
                        } else {
                            // ê¸°ë³¸: ë¶€ë“œëŸ¬ìš´ ì‹œì‘ê³¼ ë
                            easedFactor = easeInOutCubic(linearFactor);
                        }
                        
                        const currentStepValue = lerp(startValue, targetValue, easedFactor);
                        viewer.setJointValue(jointName, currentStepValue);
                        
                        // ë¶€ë“œëŸ¬ìš´ í”„ë ˆì„ ê°„ê²© (60fps)
                        await new Promise(resolve => setTimeout(resolve, stepDuration));
                    }
                    
                    console.log(`ğŸ¤– Joint ${jointName}: ${targetValue} (smooth animation completed)`);
                } catch (error) {
                    console.warn(`Smooth joint animation failed: ${error}`);
                    // ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì„¤ì •
                    viewer.setJointValue(jointName, targetValue);
                }
            }

            // ğŸ­ ë™ì‹œ ì¡°ì¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ (ë” ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„)
            async function animateMultipleJointsSmoothly(viewer, jointSteps, duration = 1000) {
                if (!viewer || !jointSteps.length) return;
                
                const steps = 60; // 60fps
                const stepDuration = duration / steps;
                
                // ëª¨ë“  ì¡°ì¸íŠ¸ì˜ ì‹œì‘ ê°’ ê°€ì ¸ì˜¤ê¸°
                const startValues = {};
                for (let jointStep of jointSteps) {
                    if (viewer.robot && viewer.robot.joints[jointStep.joint]) {
                        startValues[jointStep.joint] = viewer.robot.joints[jointStep.joint].angle || 0;
                    } else {
                        startValues[jointStep.joint] = 0;
                    }
                }
                
                // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                for (let i = 0; i <= steps; i++) {
                    if (!animationRunning) break;
                    
                    const linearFactor = i / steps;
                    
                    // ê° ì¡°ì¸íŠ¸ë³„ë¡œ ì• ë‹ˆë©”ì´ì…˜
                    for (let jointStep of jointSteps) {
                        const easedFactor = easeInOutSine(linearFactor);
                        const currentValue = lerp(startValues[jointStep.joint], jointStep.value, easedFactor);
                        viewer.setJointValue(jointStep.joint, currentValue);
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, stepDuration));
                }
                
                console.log(`ğŸ¤– Multiple joints animated smoothly: ${jointSteps.map(j => j.joint).join(', ')}`);
            }

            // ğŸ­ ìë™ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ í•¨ìˆ˜ (ë¶€ë“œëŸ¬ìš´ ë²„ì „)
            let animationRunning = false;
            let currentStepIndex = 0;

            async function executeFullAssemblySequence(viewer) {
                if (animationRunning) {
                    console.log('ğŸ­ Animation already running, skipping...');
                    return;
                }
                animationRunning = true;
                
                console.log('ğŸ­ Starting WADF Full Assembly Sequence (Smooth Animation)');
                
                try {
                    for (let stepInfo of FULL_ASSEMBLY_STEPS) {
                        if (!animationRunning) {
                            console.log('ğŸ­ Animation stopped by user');
                            break; // ì¤‘ë‹¨ ì‹œ ë£¨í”„ ì¢…ë£Œ
                        }
                        
                        console.log(`ğŸ­ Step ${stepInfo.step}: ${stepInfo.description}`);
                        
                        // GRIPPER_TEST2 ì‹¤í–‰ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜)
                        if (stepInfo.gripper_test && WADF_ASSEMBLY_SEQUENCE[stepInfo.gripper_test]) {
                            const sequence = WADF_ASSEMBLY_SEQUENCE[stepInfo.gripper_test];
                            
                            // ë™ì‹œì— ì—¬ëŸ¬ ì¡°ì¸íŠ¸ë¥¼ ë¶€ë“œëŸ½ê²Œ ì• ë‹ˆë©”ì´ì…˜
                            if (sequence.length > 1) {
                                // ì—¬ëŸ¬ ì¡°ì¸íŠ¸ê°€ ìˆëŠ” ê²½ìš° ë™ì‹œ ì• ë‹ˆë©”ì´ì…˜
                                const maxDelay = Math.max(...sequence.map(s => s.delay));
                                await animateMultipleJointsSmoothly(viewer, sequence, maxDelay);
                            } else {
                                // ë‹¨ì¼ ì¡°ì¸íŠ¸ì¸ ê²½ìš° ê°œë³„ ì• ë‹ˆë©”ì´ì…˜
                                for (let jointStep of sequence) {
                                    if (!animationRunning) break;
                                    
                                    await animateJointSmoothly(
                                        viewer, 
                                        jointStep.joint, 
                                        jointStep.value, 
                                        jointStep.delay,
                                        60
                                    );
                                }
                            }
                        }
                        
                        // ë‹¨ê³„ ê°„ ì§€ì—° (ë” ë¶€ë“œëŸ½ê²Œ)
                        await new Promise(resolve => setTimeout(resolve, stepInfo.delay));
                    }
                    
                    // ì‹œí€€ìŠ¤ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘ (ë¬´í•œ ë°˜ë³µ)
                    console.log('ğŸ­ Assembly sequence completed, preparing restart...');
                    
                } catch (error) {
                    console.error('ğŸ­ Animation error:', error);
                } finally {
                    // ì• ë‹ˆë©”ì´ì…˜ í”Œë˜ê·¸ ë¦¬ì…‹
                    animationRunning = false;
                    
                    // 2ì´ˆ í›„ ìë™ ì¬ì‹œì‘
                    setTimeout(() => {
                        console.log('ğŸ­ Restarting assembly sequence...');
                        executeFullAssemblySequence(viewer);
                    }, 2000);
                }
            }

            // URDF ë·°ì–´ ì´ˆê¸°í™” í™•ì¸
            document.addEventListener('DOMContentLoaded', () => {
                const viewer = document.querySelector('urdf-viewer');
                if (viewer) {
                    console.log('Agent View URDF Viewer initialized successfully');
                    
                    // ì¹´ë©”ë¼ ì´ˆê¸° ì„¤ì • (4ë°° í™•ëŒ€ + 90ë„ ë°˜ì‹œê³„ë°©í–¥ íšŒì „)
                    viewer.noAutoRecenter = false; // autocenter í™œì„±í™”
                    
                    // ì¹´ë©”ë¼ í™•ëŒ€ ë° íšŒì „ ì„¤ì •
                    viewer.addEventListener('urdf-processed', () => {
                        if (viewer.scene && viewer.camera) {
                            // ì¹´ë©”ë¼ ê±°ë¦¬ë¥¼ 1/5.5ë¡œ ì¤„ì—¬ì„œ 5.5ë°° í™•ëŒ€
                            const originalDistance = viewer.camera.position.length();
                            viewer.camera.position.multiplyScalar(1/5.5);
                            
                            // ì¹´ë©”ë¼ë¥¼ ë°˜ì‹œê³„ë°©í–¥ìœ¼ë¡œ 150ë„ íšŒì „ (Yì¶• ê¸°ì¤€)
                            const rotationY = 150 * Math.PI / 180; // 150ë„ (ë°˜ì‹œê³„ë°©í–¥)
                            viewer.camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);
                            
                            // ì¹´ë©”ë¼ë¥¼ ìœ„ìª½ìœ¼ë¡œ ì˜¬ë¦¬ê¸°
                            viewer.camera.position.y += 1.7; // ì¹´ë©”ë¼ ìì²´ë¥¼ ìœ„ë¡œ ì˜¬ë¦¼
                            
                            // ì¹´ë©”ë¼ê°€ ëª¨ë¸ì„ ë°”ë¼ë³´ë„ë¡ ì„¤ì •
                            if (viewer.robot) {
                                const robotCenter = new THREE.Vector3();
                                viewer.robot.getWorldPosition(robotCenter);
                                viewer.camera.lookAt(robotCenter);
                            }
                            
                            viewer.camera.updateProjectionMatrix();
                            console.log('ğŸ“· Camera zoomed 4x and rotated 90Â° counter-clockwise');
                            
                            // ğŸ­ URDF ë¡œë”© ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                            setTimeout(() => {
                                console.log('ğŸ­ Starting automatic assembly animation');
                                executeFullAssemblySequence(viewer);
                            }, 2000); // 2ì´ˆ í›„ ìë™ ì‹œì‘
                        }
                    });
                    
                    // ë©”ì‹œ ë¡œë” ì„¤ì • (ì›ë³¸ ì˜ˆì œì™€ ë™ì¼)
                    viewer.loadMeshFunc = (path, manager, done) => {
                        const ext = path.split(/\./g).pop().toLowerCase();
                        switch (ext) {
                            case 'gltf':
                            case 'glb':
                                new GLTFLoader(manager).load(
                                    path,
                                    result => done(result.scene),
                                    null,
                                    err => done(null, err),
                                );
                                break;
                            case 'obj':
                                new OBJLoader(manager).load(
                                    path,
                                    result => done(result),
                                    null,
                                    err => done(null, err),
                                );
                                break;
                            case 'dae':
                                new ColladaLoader(manager).load(
                                    path,
                                    result => done(result.scene),
                                    null,
                                    err => done(null, err),
                                );
                                break;
                            case 'stl':
                                new STLLoader(manager).load(
                                    path,
                                    result => {
                                        const material = new THREE.MeshPhongMaterial();
                                        const mesh = new THREE.Mesh(result, material);
                                        done(mesh);
                                    },
                                    null,
                                    err => done(null, err),
                                );
                                break;
                        }
                    };
                }
            });
        </script>
    </body>
</html>
